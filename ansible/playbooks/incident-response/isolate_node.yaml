---
# This playbook uses conditional logic to handle your diverse environment (Debian, Alma, Windows).

- name: "[ðŸš¨] Sovereign-Shield v2: Cross-Platform Isolation"
  hosts: "{{ target }}"
  become: yes
  tasks:

    # --- LINUX SECTION (Debian, Ubuntu, Alma, Metasploitable) ---
    - name: "Linux: Apply eBPF/IPTables quarantine"
      ansible.builtin.iptables:
        chain: INPUT
        jump: DROP
        comment: "Managed by Sovereign-Shield v2"
      when: os_family != 'Windows'

    # --- WINDOWS SECTION (Server 2019, Win 11) ---
    - name: "Windows: Block all traffic via Netsh"
      community.windows.win_shell: |
        New-NetFirewallRule -DisplayName "Sovereign-Shield Quarantine" -Direction Inbound -Action Block -Enabled True
      when: os_family == 'Windows'

    - name: "Forensics: Gather Evidence before total shutdown"
      include_tasks: gather_evidence.yml