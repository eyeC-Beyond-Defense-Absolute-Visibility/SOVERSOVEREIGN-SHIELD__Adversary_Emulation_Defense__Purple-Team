---
# Main Deployment Playbook
# Objective: Hardening the OS and deploying Cilium eBPF policies.

- name: "[üõ°Ô∏è] Sovereign-Shield: Infrastructure Hardening"
  hosts: all
  become: yes # Required for kernel/system modifications
  vars_files:
    - ../vars/global_config.yml

  roles:
    - os_hardening # Generic Linux hardening (SSH, sysctl, auditd)
    - cilium       # eBPF installation and setup

  tasks:
    - name: Apply eBPF-based Network Policies
      kubernetes.core.k8s:
        state: present
        src: "../../policies/shield-policy.yaml"
      tags: [enforce]